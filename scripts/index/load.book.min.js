loadNewsMore();
function loadNewsMore() {
    var urlAjax = "/CsAjax.do?method=getBookListCommon"
    var $loadMore = $('#loadMore');
    var $book_list = $('#book_list');
    var e = {
        type: "",
        page_num: $loadMore.data("pagenum"),
        cls_id: $loadMore.data("cls_id"),
        par_id: $loadMore.data("par_id"),
        author_id: $loadMore.data("author_id"),
        order_type: "",
        keyword: $loadMore.data("keyword")
    };
    console.log(e);
    $loadMore.html("<p>加载中...</p>");
    var page = Number(e.page_num);
    $.post(urlAjax, e, function(ret){
        if(ret.code == "0"){
            alertModal(ret.msg)
            $loadMore.html("<p>点击加载更多</p>");
            return false;
        }
        page += 1;
        var divId = "ad"+new Date().getTime();
        var html = '';
        var time = new Date().getTime();
        var data = ret.records;
        for (var i = 0; i < data.length; i++) {
            var book = data[i];
            var url = "/" + book.bUrl + "-zh.html";
            var url_cate = "/category-"+book.cid+".html";
            var url_author = "/author-"+book.aid+".html";
            var cdn = "";
            if (typeof ctx_cdn !== "undefined") {
                cdn = ctx_cdn;
            }
            var imgUrl = cdn+"/files/book/cover/"+book.bid+"/cover.jpg";
            html += '<li> <div class="item_avat fl"> <a href="'+url+'"><img src="'+imgUrl+'" onerror="this.src=\'/styles/index/images/noimage.jpg\'" /></a> </div> <div class="item_info"> <h3><a href="'+url+'">'+book.bName+'</a></h3> <p>'+i18nUtils.prop("book_genre")+': <a href="'+url_cate+'">'+book.cat+'</a><br> '+i18nUtils.prop("book_author")+': <a href="'+url_author+'">'+book.aName+'</a><br> '+i18nUtils.prop("book_status")+': '+book.state+' <br>  '+book.bDesc+'</p> </div> <div class="item_down"> <a href="'+url+'" class="btn_down_book">'+i18nUtils.prop("book_free_read")+'</a> </div> </li>';
        }
        $book_list.append(html);
        $(".lazy"+time).lazyload({
            threshold : 200,
            effect : "fadeIn"
        });
        $("#search_result_count").text(ret.recordCount)
        if(data.length < 10) {
            if(page===1&&data.length===0){
                $("#data-empty").show();
            }
            $loadMore.after('<div class="book_upto_page" style="text-align: center;color: #ccc;"><p>全部加载完成</p></div>');
            $loadMore.remove();
            return false;
        }

        $loadMore.html("<p>点击加载更多</p>").data('pagenum', page);
    });
}

function alertModal(msg) {
    alert(msg)
}